{% extends "base.html" %}
{% block content %}
<div class="section-title">
    <h2>Your Shopping Cart</h2>
    <p>Review your items and proceed to checkout</p>
</div>

<div class="cart-content">
    {% if cart_items %}
    <form action="{{ url_for('checkout') }}" method="post" id="checkout-form">
        <div class="cart-items">
            {% for item in cart_items %}
            <div class="cart-item">
                <div class="cart-item-info">
                    <input type="checkbox" name="selected_items" value="{{ item.id }}" class="item-checkbox">
                    <h3>{{ item.product.name }}</h3>
                    <p>{{ item.product.description }}</p>
                    <p><strong>Price:</strong> ₱{{ "%.2f"|format(item.product.price) }}</p>
                    <p><strong>Quantity:</strong> {{ item.quantity }}</p>
                    <p><strong>Subtotal:</strong> ₱{{ "%.2f"|format(item.product.price * item.quantity) }}</p>
                </div>
                <div class="cart-item-actions">
                    <form action="{{ url_for('remove_from_cart', cart_id=item.id) }}" method="post">
                        <button type="submit" class="btn btn-outline">Remove</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="cart-total">
            <h3 id="selected-total">Total: ₱0.00</h3>
            <div class="delivery-info">
                <h4>Delivery Information</h4>
                <div class="form-group">
                    <label for="name">Full Name:</label>
                    <input type="text" id="name" name="name" value="{{ session.get('name', '') }}" required>
                </div>
                <div class="form-group">
                    <label for="address">Delivery Address:</label>
                    <textarea id="address" name="address" rows="3" placeholder="Enter your complete delivery address" required></textarea>
                </div>
                <div class="form-group">
                    <label for="contact">Contact Number:</label>
                    <input type="tel" id="contact" name="contact" placeholder="09123456789" required>
                </div>
            </div>
            <div class="payment-methods">
                <h4>Select Payment Method:</h4>
                <div class="payment-options">
                    <label class="payment-option">
                        <input type="radio" name="payment_method" value="Cash on Delivery" checked>
                        <span>Cash on Delivery</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="payment_method" value="GCash">
                        <span>GCash</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="payment_method" value="PayMaya">
                        <span>PayMaya</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="payment_method" value="Credit Card">
                        <span>Credit Card</span>
                    </label>
                </div>
            </div>
            <button type="submit" class="btn btn-primary" id="checkout-btn">Checkout Selected Items</button>
        </div>
    </form>
    {% else %}
    <div class="empty-cart">
        <p>Your cart is empty.</p>
        <a href="{{ url_for('shop') }}" class="btn btn-primary">Continue Shopping</a>
    </div>
    {% endif %}
</div>

<style>
.cart-content {
    max-width: 800px;
    margin: 0 auto;
}

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.cart-item-info {
    display: flex;
    align-items: flex-start;
    gap: 15px;
}

.cart-item-info input[type="checkbox"] {
    margin-top: 5px;
}

.cart-item-info h3 {
    margin-bottom: 10px;
    color: var(--dark-color);
    margin-top: 0;
}

.cart-item-info p {
    margin-bottom: 5px;
    color: var(--text-light);
    margin-top: 0;
}

.cart-item-actions {
    flex-shrink: 0;
}

.cart-total {
    background: white;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-top: 30px;
}

.cart-total h3 {
    margin-bottom: 20px;
    color: var(--dark-color);
}

.empty-cart {
    text-align: center;
    background: white;
    border-radius: 8px;
    padding: 40px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.empty-cart p {
    margin-bottom: 20px;
    color: var(--text-light);
}

.payment-methods {
    margin-top: 20px;
}

.payment-methods h4 {
    margin-bottom: 15px;
    color: var(--dark-color);
}

.payment-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.payment-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.payment-option:hover {
    border-color: var(--primary-color);
    background-color: rgba(192, 47, 228, 0.05);
}

.payment-option:has(input[type="radio"]:checked) {
    border-color: var(--primary-color);
    background-color: rgba(192, 47, 228, 0.1);
}

.payment-option input[type="radio"] {
    margin: 0;
    accent-color: var(--primary-color);
}

.payment-option span {
    font-weight: 500;
    color: var(--text-color);
}

#checkout-btn {
    margin-top: 20px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('.item-checkbox');
    const selectedTotal = document.getElementById('selected-total');
    const checkoutBtn = document.getElementById('checkout-btn');

    function updateTotal() {
        let total = 0;
        let selectedCount = 0;
    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            selectedCount++;
            const itemDiv = checkbox.closest('.cart-item');
            const subtotalText = itemDiv.querySelector('p:last-of-type').textContent;
            const subtotal = parseFloat(subtotalText.split('₱')[1].replace(',', ''));
            total += subtotal;
        }
    });
        selectedTotal.textContent = `Total: ₱${total.toFixed(2)}`;
        checkoutBtn.disabled = selectedCount === 0;
        checkoutBtn.textContent = selectedCount === 0 ? 'Select items to checkout' : `Checkout ${selectedCount} Selected Item${selectedCount > 1 ? 's' : ''}`;
    }

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateTotal);
    });

    updateTotal(); // Initial calculation
});
</script>
{% endblock %}
